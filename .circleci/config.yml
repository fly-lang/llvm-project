# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

orbs:
  # The Windows orb give you everything you need to start using the Windows executor.
  win: circleci/windows@4.1.1
  
# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
  build:
    executor: win/default
    # Add steps to the job
    # See: https://circleci.com/docs/2.0/configuration-reference/#steps
    steps:
      - checkout
      - run: choco install cmake -y --installargs 'ADD_CMAKE_TO_PATH=User'
      - run:
         command: |
           cmake -E make_directory build
           cmake -E make_directory install/llvm
           cd build
           cmake ../llvm -DCMAKE_BUILD_TYPE=Debug -DLLVM_ENABLE_PROJECTS=lld -DCMAKE_INSTALL_PREFIX=install/llvm
           cmake --build . --config Debug --target install
           cd install
           7z a llvm-11.1.0-Debug-win-x64.zip *


# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
  build-workflow:
    jobs:
      - build
